(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{15:function(e,t,n){e.exports=n(27)},26:function(e,t,n){},27:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),o=n(2),c=n.n(o),r=n(14),i=n(3),m=n(4),l=n(1),u=n(8),g=n(7),p=function(e){Object(u.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this)).userName=localStorage.getItem("userName"),e.pressEnter=function(t){"Enter"===t.key&&e.submitMessage(t)},e.state={msgIn:"",nameIn:""},e.submitMessage=e.submitMessage.bind(Object(l.a)(e)),e.pressEnter=e.pressEnter.bind(Object(l.a)(e)),e}return Object(m.a)(n,[{key:"componentDidMount",value:function(){this.userName&&this.setState({nameIn:localStorage.getItem("userName")}),document.addEventListener("keydown",this.pressEnter,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.pressEnter,!1)}},{key:"submitMessage",value:function(e){""===this.state.msgIn?alert("Enter message"):(e.preventDefault(),this.userName&&this.userName===this.state.nameIn||localStorage.setItem("userName",this.state.nameIn),this.props.SendMessage(this.state.nameIn,this.state.msgIn),this.setState({msgIn:""}))}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"input-wrapper"},s.a.createElement("div",{className:"name-wrapper"},s.a.createElement("input",{className:"name",type:"name",placeholder:"Your name",value:this.state.nameIn,onChange:function(t){e.setState({nameIn:t.target.value})}}),s.a.createElement("button",{className:"close",onClick:this.props.wsClose},"Close and Recconect",s.a.createElement("span",null,s.a.createElement("i",{className:"fas fa-plug"})))),s.a.createElement("textarea",{className:"message",placeholder:"type your message here",type:"text",value:this.state.msgIn,onChange:function(t){e.setState({msgIn:t.target.value})}}),s.a.createElement("button",{type:"submit",className:"send",onClick:this.submitMessage},"Send",s.a.createElement("span",null,s.a.createElement("i",{className:"fas fa-arrow-up"}))))}}]),n}(s.a.Component);var d=function(e){var t;return t=e.ownerName.includes(e.name)?"message-wrapper owner":"message-wrapper",s.a.createElement("div",{className:t},s.a.createElement("div",{className:"message-content"},s.a.createElement("div",{className:"info"},s.a.createElement("h4",{className:"name"},e.name),s.a.createElement("p",{className:"time"},e.getTime(e.time))),s.a.createElement("p",{className:"message"},e.message," ")))};var f=function(e){return"disconnected"===e.stance?s.a.createElement("h4",null," Connection lost :("):null};var h=function(e){return"connected"===e.stance?s.a.createElement("h4",null," U have been connected"):s.a.createElement("h4",{className:"hidden"}," U have been connected")},E=n(6),v=function(e){Object(u.a)(n,e);var t=Object(g.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this)).connect=function(){a.ws=new WebSocket("ws://st-chat.shas.tel"),a.ws.onopen=function(){console.log("connected"),a.props.dispatch({type:"CLEAR_MESSAGES"}),a.setState({stance:"connected"})},setTimeout((function(){a.setState({stance:"waiting"})}),5e3),a.ws.onmessage=function(e){var t=JSON.parse(e.data);if(a.props.dispatch({type:"ADD_MESSAGES",payload:t}),a.props.messages.sort((function(e,t){return e.time-t.time})),a.scrollToBottom("messages-wrapper"),"visible"!==document.visibilityState){var n=new Notification("New Message from "+t[0].from);setTimeout((function(){return n.close()}),3e3)}},a.wsClose=function(){a.ws.close()},a.ws.onclose=function(){console.log("disconnected"),a.setState({stance:"disconnected"}),a.reconnect=setInterval((function(){console.log("connecting"),a.connect()}),3e3)},a.ws.onerror=function(e){console.error(e)},a.reconnect&&(console.log("clearing Interval"),clearInterval(a.reconnect))},a.scrollToBottom=function(e){var t=document.getElementById(e);t.scrollTop=t.scrollHeight},a.notifyMe=function(){"Notification"in window?"granted"===Notification.permission||"denied"!==Notification.permission&&Notification.requestPermission().then((function(e){if("granted"===e){var t=new Notification("Welcome to the Epic Chat");setTimeout((function(){return t.close()}),3e3)}})):alert("This browser does not support desktop notification")},a.submitMessage=function(e,t){a.state.ownerName.includes(localStorage.getItem("userName"))||a.setState({ownerName:[].concat(Object(r.a)(a.state.ownerName),[localStorage.getItem("userName")])});var n={from:e,message:t};a.ws.send(JSON.stringify(n))},a.getTime=function(e){if(e){var t=new Date(e);return"".concat(n(t.getHours()),":").concat(n(t.getMinutes()),":").concat(n(t.getSeconds()))}function n(e){return e<10&&(e="0"+e),e}},a.state={stance:"",ownerName:""},a.getTime=a.getTime.bind(Object(l.a)(a)),a.notifyMe=a.notifyMe.bind(Object(l.a)(a)),a.scrollToBottom=a.scrollToBottom.bind(Object(l.a)(a)),a}return Object(m.a)(n,[{key:"componentDidMount",value:function(){this.connect(),this.notifyMe(),this.setState({ownerName:[localStorage.getItem("userName")]})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement("div",{className:"header"},s.a.createElement("h1",null,"Epic Chat"),s.a.createElement(h,{stance:this.state.stance}),s.a.createElement(f,{stance:this.state.stance})),s.a.createElement(p,{SendMessage:this.submitMessage,wsClose:this.wsClose}),s.a.createElement("div",{className:"messages-wrapper",id:"messages-wrapper"},this.props.messages.map((function(t,n){return s.a.createElement(d,{ownerName:e.state.ownerName,key:n,getTime:e.getTime,time:t.time,name:t.from,message:t.message})}))))}}]),n}(s.a.Component),N=Object(E.b)((function(e){return{messages:e.messages}}))(v),w=n(5),b={messages:[]};var S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;return"ADD_MESSAGES"===t.type?Object.assign({},e,{messages:e.messages.concat(t.payload)}):"CLEAR_MESSAGES"===t.type?Object.assign({},e,{messages:[]}):e},y=Object(w.b)(S);n(26);function I(){return window.store=y,s.a.createElement("div",{className:"app"},s.a.createElement(N,null))}var M=document.getElementById("root");c.a.render(s.a.createElement(E.a,{store:y},s.a.createElement(I,null)),M)}},[[15,1,2]]]);
//# sourceMappingURL=main.20d8f4c0.chunk.js.map